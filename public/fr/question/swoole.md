# Origine et motivation du projet Swoole

Ce document est rédigé par Rango, fondateur du projet Swoole open source, et représente uniquement son point de vue personnel.

## Origine du projet

L'idée originale du projet Swoole provient d'un projet de logiciels d'entreprise précédent. À la fin de l'année 2010, l'une des fonctionnalités de l'entreprise était que les utilisateurs pouvaient générer n'importe quel email, puis que d'autres utilisateurs pouvaient envoyer des emails à cet email, et que le système backend pouvait parser en temps réel le contenu des emails en données et notifier les utilisateurs de manière proactive. À l'époque, le projet était développé en PHP et, lors de la mise en œuvre de cette fonctionnalité, nous avons rencontré des difficultés. PHP ne pouvait compter que sur d'autres serveurs SMTP pour récupérer les nouveaux emails par POP3 à l'heure, ce qui n'était pas en temps réel. Pour mettre en place un système en temps réel, il fallait écrire un serveur TCP Socket pour implémenter le protocole SMTP et recevoir les données. À cette époque, PHP était presque inexistant dans ce domaine, sans cadre de communication réseau mature. Afin de réaliser le besoin, j'ai appris à partir des sockets jusqu'à la TCP/IP, à la réutilisation des I/O, à libevent, aux processus multiples, et finalement j'ai réalisé ce programme. Après avoir terminé ce projet, j'ai voulu ouvrir le code pour aider d'autres PHPers à résoudre les problèmes dans ce domaine. Si un tel cadre existait, PHP pourrait s'étendre au-delà de la simple création de sites web.

## Questions de performance

Une autre raison importante est les problèmes de performance des programmes PHP. J'étais à l'origine un programmeur Java et je suis passé à PHP par la suite. En utilisant PHP pour développer des programmes, je me suis toujours demandé quelle était la plus grande advantage de PHP par rapport à Java. Simple et efficace, PHP libère toutes les ressources et la mémoire après l'achèvement d'une demande, sans avoir à s'inquiéter de fuites de mémoire. La qualité du code, qu'elle soit élevée ou basse, fonctionne très bien. Cependant, c'est aussi un défaut fatal de PHP. Une fois que le nombre de demandes augmente et que la concurrency est élevée, la création rapide de ressources suivie d'une libération rapide réduit considérablement l'efficacité d'exécution des programmes PHP. De plus, à mesure que les fonctionnalités du projet deviennent de plus en plus complexes et que le code augmente, cela devient un désastre pour PHP. C'est aussi pourquoi les cadres PHP n'ont pas été largement adoptés par les programmeurs PHP, tandis que Java ne pose pas ce problème. Même le meilleur cadre peut être ralenti par cette manière inefficace, rendant le système lent. C'est pourquoi j'ai pensé à utiliser PHP pour développer un serveur d'applications PHP, permettant au code PHP de rester en mémoire après le chargement et d'avoir une vie plus longue, de sorte que les connexions de base de données et d'autres grands objets ne soient pas libérés. Chaque demande ne traite qu'un petit code, et ce code n'est compilé par le compilateur PHP que la première fois qu'il est exécuté, restant en mémoire. De plus, ce que PHP ne pouvait pas réaliser auparavant, comme la persistance des objets, les pools de connexions de base de données, les pools de connexions de cache peuvent être réalisés. L'efficacité opérationnelle du système s'améliorera considérablement.

Après une période de recherche, nous avons actuellement une réalisation préliminaire. En utilisant PHP pour écrire un serveur HTTP, fonctionnant en tant que serveur indépendant, le temps d'exécution d'une seule page de programme (avec la génération d'objets, les connexions de base de données, l'opération des modèles Smarty) est passé de 0.0x seconde à 0.00x seconde. Avec un test de concurrency Apache AB à 100, il est au moins 10 fois plus rapide que la méthode traditionnelle LAMP. Sur ma machine de test (Ubuntu 10.04 Inter Core E5300 + 2G de mémoire), Apache n'atteint que 83 RPS. Le serveur Swoole peut atteindre plus de 1150 RPS.

Ce projet était le prototype du Swoole. Cette version a été maintenue pendant plus de deux ans, au cours desquels nous avons progressivement acquis de l'expérience et une compréhension plus approfondie des problèmes de cette solution technique, tels que les performances médiocres, les restrictions nombreuses qui empêchent de faire directement appel aux interfaces du système d'exploitation, et l'inefficacité de la gestion de la mémoire.

## Entrée chez Tencent

À la fin de l'année 2011, je suis entré chez Tencent pour travailler sur le développement de la plateforme PHP de Renren. J'ai été surpris de découvrir que les collègues de Renren avaient non seulement pensé à cela, mais qu'ils l'avaient déjà mis en œuvre. L'équipe de Renren utilisait déjà cette solution dans un environnement de production. Renren avait trois chevaux de Troie : le premier était PWS, un serveur Web écrit entièrement en PHP, avec plus de 600 serveurs fonctionnant sur PWS sans utiliser d'Apache, PHP-FPM ou d'autres programmes. Le deuxième était SAPS, une file de distribution développée entièrement en PHP, avec environ 150 serveurs de cluster en fonctionnement, et de nombreuses logiques telles que le redimensionnement des images, le traitement des avatar, le traitement des messages en même temps, la synchronisation des données, etc., étaient toutes réalisées en utilisant SAPS pour l'asynchronement logique. Le troisième était PSF, un cadre de serveur réalisé en PHP, et de nombreux serveurs de la couche logique de Renren étaient basés sur PSF. Environ 300 clusters de serveurs PSF étaient en fonctionnement. Pendant mon temps chez Renren, j'ai appris beaucoup sur les couches inférieures de Linux, la communication réseau, et j'ai accumulé beaucoup d'expérience dans la surveillance et le débogage de la communication réseau dans des environnements à haute concurrency de clusters massifs, jetant ainsi les bases pour le développement de Swoole.

## Développement de Swoole

Pendant ce temps, j'ai également appris et compris d'excellentes solutions technologiques telles que Node.js et Golang, ce qui m'a donné plus d'inspiration. En 2012, j'ai eu une nouvelle idée et j'ai décidé de réaliser une version plus puissante et plus fonctionnelle en utilisant le langage C. C'est l'actuelle extension Swoole.

Actuellement, Swoole est utilisé par de nombreuses équipes techniques PHP pour le développement de projets pratiques, tant en Chine qu'à l'étranger. Parmi les plus connus en Chine, il y a le centre des commandes de Baidu, la carte de Baidu, les comptes publics QQ de Tencent et QQ Corporate, les diffusions de Zhanqi, 360, Dangdang, Qunar, etc. De plus, de nombreux projets IoT, hardware et de jeux utilisent également Swoole. En outre, il y a de plus en plus de cadres open source basés sur Swoole, tels que TSF, Blink, swPromise, etc., qui peuvent être trouvés sur GitHub avec de nombreux projets et codes liés à Swoole.

## Origine du nom

Le nom Swoole n'est pas un mot anglais, c'est un mot sonore créé par moi. Le premier nom que j'ai pensé était `sword-server`, signifiant créer une épée tranchante pour les nombreux PHPers, puis je me suis rappelé que Google avait également été créé de rien, donc je l'ai nommé `swoole`.
