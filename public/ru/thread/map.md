# Безопасный параллельный контейнер Map

Создание параллельной структуры `Map`, которая может быть передана в качестве аргумента для дочерних线程. Читая и пиша, она видна другим线程ам.

## Особенности
- `Map`, `ArrayList`, `Queue` автоматически распределяют память, не требуется фиксированное распределение как у `Table`.

- В основе лежит автоматическое блокирование, что делает его безопасным для线程.

- Типы переменных, которые можно передавать, см. в [тидах данных](thread/transfer.md).

- Не поддерживается итератор, вместо него можно использовать `keys()`, `values()`, `toArray()`.

- Объекты `Map`, `ArrayList`, `Queue` должны быть переданы в качестве параметров для дочерних线程 до создания线程.

- `Thread\Map` реализует интерфейсы `ArrayAccess` и `Countable`, что позволяет напрямую работать с ними как с массивами.

## Пример
```php
use Swoole\Thread;
use Swoole\Thread\Map;

$args = Thread::getArguments();
if (empty($args)) {
    $map = new Map;
    $thread = new Thread(__FILE__, $i, $map);
    sleep(1);
    $map['test'] = unique();
    $thread->join();
} else {
    $map = $args[1];
    sleep(2);
    var_dump($map['test']);
}
```

- Добавление или изменение: `$map[$key] = $value`

- Удаление: `unset($map[$key])`

- Чтение: `$value = $map[$key]`
- Получение длины: `count($map)`

## Методы

### __construct()
Конструктор безопасного параллельного контейнера `Map`

```php
Swoole\Thread\Map->__construct(?array $values = null)
```

- `$values` опционален, проходя по массиве, добавляет значения из массива в `Map`

### add()
Записывает данные в `Map`

```php
Swoole\Thread\Map->add(mixed $key, mixed $value) : bool
```
  * **Параметры**
      * `mixed $key`
          * Функция: ключ, который необходимо добавить.
          * По умолчанию: нет.
          * Прочие значения: нет.
  
      * `mixed $value`
          * Функция: значение, которое необходимо добавить.
          * По умолчанию: нет.
          * Прочие значения: нет.
  
  * **Возвращаемое значение**
      * Если `$key` уже существует, возвращает `false`, в противном случае возвращает `true`, указывая успешное добавление.

### update()
Обновляет данные в `Map`

```php
Swoole\Thread\Map->update(mixed $key, mixed $value) : bool
```

  * **Параметры**
      * `mixed $key`
          * Функция: ключ, который необходимо изменить.
          * По умолчанию: нет.
          * Прочие значения: нет.
  
      * `mixed $value`
          * Функция: значение, которое необходимо изменить.
          * По умолчанию: нет.
          * Прочие значения: нет.
  
  * **Возвращаемое значение**
      * Если `$key` не существует, возвращает `false`, в противном случае возвращает `true`, указывая успешную обновление.


### incr()
Безопасно увеличивает значение в `Map`, поддерживает как целые, так и плавающие числа. Если на другие виды данных будет произведено увеличение, они автоматически будут преобразованы в целые и инициированы до `0`, после чего будет произведено увеличение.

```php
Swoole\Thread\Map->incr(mixed $key, mixed $value = 1) : int | float
```
* **Параметры**
    * `mixed $key`
        * Функция: ключ, который необходимо увеличить. Если он не существует, то автоматически создается и инициируется до `0`.
        * По умолчанию: нет.
        * Прочие значения: нет.

    * `mixed $value`
        * Функция: значение, которое необходимо увеличить.
        * По умолчанию: 1.
        * Прочие значения: нет.

* **Возвращаемое значение**
    * Возвращает увеличенное значение.


### decr()
Безопасно уменьшает значение в `Map`, поддерживает как целые, так и плавающие числа. Если на другие виды данных будет произведено уменьшение, они автоматически будут преобразованы в целые и инициированы до `0`, после чего будет произведено уменьшение.

```php
Swoole\Thread\Map->decr(mixed $key, mixed $value = 1) : int | float
```
* **Параметры**
    * `mixed $key`
        * Функция: ключ, который необходимо уменьшить. Если он не существует, то автоматически создается и инициируется до `0`.
        * По умолчанию: нет.
        * Прочие значения: нет.

    * `mixed $value`
        * Функция: значение, которое необходимо уменьшить.
        * По умолчанию: 1.
        * Прочие значения: нет.

* **Возвращаемое значение**
    * Возвращает уменьшенное значение.


### count()
Получает количество элементов

```php
Swoole\Thread\Map()->count(): int
```

  * **Возвращаемое значение**
      * Возвращает количество элементов в Map.


### keys()
Возвращает все `key`

```php
Swoole\Thread\Map()->keys(): array
```

  * **Возвращаемое значение**
    * Возвращает все `key` в `Map`


### values()
Возвращает все `value`

```php
Swoole\Thread\Map()->values(): array
```

* **Возвращаемое значение**
    * Возвращает все `value` в `Map`


### toArray()
Конвертирует `Map` в массив

```php
Swoole\Thread\Map()->toArray(): array
```

### clean()
Очищает все элементы

```php
Swoole\Thread\Map()->clean(): void
```
