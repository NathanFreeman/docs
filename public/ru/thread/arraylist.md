# Безопасный параллельный контейнер List

Создание параллельной структуры `List`, которая может быть передана в качестве параметра нити child thread. Читая и пишя, она видна другим нитям.




## Особенности
- `Map`, `ArrayList`, `Queue` автоматически распределяют память, не требуется фиксированное распределение как у `Table`.


- На уровне реализации автоматически применяется блокировка, что делает его безопасным для многопутевого доступа.


- В качестве передаваемого переменного типа можно посмотреть на [типы данных](thread/transfer.md)


- Не поддерживается итератор, вместо него можно использовать `toArray()`


- Объекты `Map`, `ArrayList`, `Queue` должны быть переданы в качестве параметров нити child thread до создания нити


- `Thread\ArrayList` реализует интерфейсы `ArrayAccess` и `Countable`, что позволяет напрямую работать с ними как с массивом


- `Thread\ArrayList` поддерживает операции с числовыми индексами только, для нечисловых индексов будет выполнена принудительная преобразование


## Пример
```php
use Swoole\Thread;
use Swoole\Thread\ArrayList;

$args = Thread::getArguments();
if (empty($args)) {
    $list = new ArrayList;
    $thread = new Thread(__FILE__, $i, $list);
    sleep(1);
    $list[] = unique();
    $thread->join();
} else {
    $list = $args[1];
    sleep(2);
    var_dump($list[0]);
}
```



- Добавление или изменение: `$list[$index] = $value`

- Удаление: `unset($list[$index])`

- Чтение: `$value = $list[$index]`
- Получение длины: `count($list)`


## Удаление
Пожалуйста, обратите внимание, что операции удаления могут вызвать массовое перемещение вперед элементов `List`. Например, если у `List` есть `1000` элементов и вы выполняете `unset($list[4])`, то потребуется массовое перемещение элементов `$list[5:999]` для заполнения пустых мест, оставшихся после удаления `$list[4]`. Однако элементы не копируются глубоко, их указатели просто перемещаются.

> Если `List` очень большая, удаление элементов с начала может потребовать много CPU ресурсов


## Методы


### __construct()
Конструктор безопасного параллельного контейнера `ArrayList`

```php
Swoole\Thread\ArrayList->__construct(?array $values = null)
```



- `$values` - необязательный параметр, который позволяет добавить значения из массива в `ArrayList` путем его итерации

- Принимает только массивы типа `list`, Associative arrays не принимаются, в противном случае будет выброшено исключение
- Для Associative arrays необходимо использовать `array_values` для преобразования в массив типа `list`


### incr()
Безопасное увеличение значения в `ArrayList` на один, поддерживает как числовые (float или int), так и другие виды значений. Если попытаться увеличить значение другого типа, оно будет автоматически преобразовано в int и начат с 0.

```php
Swoole\Thread\ArrayList->incr(int $index, mixed $value = 1) : int | float
```

* **Параметры**
    * `int $index`
        * Функция: индекс числа, должен быть действительным адресом индекса, в противном случае будет выброшено исключение.
        * По умолчанию: нет.
        * Другие значения: нет.

    * `mixed $value`
        * Функция: значение, которое нужно увеличить.
        * По умолчанию: 1.
        * Другие значения: нет.

* **Возвращаемое значение**
    * Возвращает увеличенное значение.


### decr()
Безопасное уменьшение значения в `ArrayList` на один, поддерживает как числовые (float или int), так и другие виды значений. Если попытаться уменьшить значение другого типа, оно будет автоматически преобразовано в int и начат с 0.

```php
Swoole\Thread\ArrayList->(int $index, $value = 1) : int | float
```

* **Параметры**
    * `int $index`
        * Функция: индекс числа, должен быть действительным адресом индекса, в противном случае будет выброшено исключение.
        * По умолчанию: нет.
        * Другие значения: нет.

    * `mixed $value`
        * Функция: значение, которое нужно уменьшить.
        * По умолчанию: 1.
        * Другие значения: нет.

* **Возвращаемое значение**
    * Возвращает уменьшенное значение.


### count()
Получение количества элементов в `ArrayList`

```php
Swoole\Thread\ArrayList()->count(): int
```

* **Возвращаемое значение**
    * Возвращает количество элементов в List.


### toArray()
Конвертация `ArrayList` в массив

```php
Swoole\Thread\ArrayList()->toArray(): array
```

* **Возвращаемое значение**
    * Возвращает массив, содержащий все элементы `ArrayList`.

### clean()
Очищение всех элементов

```php
Swoole\Thread\ArrayList()->clean(): void
```
