# TCP сервер

## Программа код

Пожалуйста, напишите следующий код в tcpServer.php.

```php
// Создание объекта Server, слушающего на порту 127.0.0.1:9501.
$server = new Swoole\Server('127.0.0.1', 9501);

// Слушание события подключения.
$server->on('Connect', function ($server, $fd) {
    echo "Клиент: Подключение.\n";
});

// Слушание события приема данных.
$server->on('Receive', function ($server, $fd, $reactor_id, $data) {
    $server->send($fd, "Сервер: {$data}");
});

// Слушание события закрытия соединения.
$server->on('Close', function ($server, $fd) {
    echo "Клиент: Закрытие.\n";
});

// Запуск сервера
$server->start(); 
```

Таким образом, создан `TCP` сервер, слушающий на локальном порту `9501`. Его логика очень проста: когда клиент `Socket` отправляет через сеть字符串 `hello`, сервер отвечает字符串ом `Сервер: hello`.

`Сервер` - это асинхронный сервер, поэтому программирование проводится путем прослушивания событий. Когда происходит соответствующее событие, нижестоящая часть активно вызывает указанную функцию обратной связи. Например, когда一个新的 `TCP` соединение установлено, выполняется обратная связь события [onConnect](/server/events?id=onconnect), когда некоторое соединение отправляет данные на сервер, вызывается функция обратной связи [onReceive](/server/events?id=onreceive).

* Сервер может одновременно быть соединен с тысячами клиентов, `$fd` - это уникальный идентификатор клиента.
* Call `$server->send()` метод для отправки данных на соединение клиента, параметр - это `$fd` идентификатор клиента.
* Call `$server->close()` метод для принудительного закрытия определенного соединения клиента.
* Клиент может активно desconnectиться, в этом случае будет вызвано событие обратной связи [onClose](/server/events?id=onclose).

## Исполнение программы

```shell
php tcpServer.php
```

Запустите программу `server.php` в командной строке, после успешного запуска можно использовать инструмент `netstat` чтобы увидеть, что сервер уже слушает на порту `9501`.

Теперь можно использовать инструменты `telnet/netcat` для подключения к серверу.

```shell
telnet 127.0.0.1 9501
hello
Сервер: hello
```

## Простой способ проверки невозможности подключения к серверу

* В `Linux` используйте `netstat -an | grep порт`, чтобы проверить, открыт ли порт и находится ли он в состоянии `Слушания`.
* После подтверждения предыдущего шага, проверите проблемы с фишингом.
* Обратите внимание на IP-адрес, используемый сервером, если это обратный адрес `127.0.0.1`, то клиенты могут подключиться только используя `127.0.0.1`.
* Если вы используете услуги от Alibaba или Tencent, вам необходимо настроить порт разработки в группе безопасности.

## Проблема границы TCP-пакетов.

Смотрите [Проблема границы TCP-пакетов](/learn?id=tcp数据包边界问题).
